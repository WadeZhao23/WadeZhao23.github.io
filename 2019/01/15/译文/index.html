<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  

  <!--Author-->
  
  <meta name="author" content="Wade Zhao">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="Using errors as control flow in Swift è¯‘æ–‡"/>
  
  <!--Open Graph Description-->
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Wade Zhao&#39;s Blog"/>
  <!--Type page-->
  
      <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title -->
  
  <title>Using errors as control flow in Swift è¯‘æ–‡ - Wade Zhao&#39;s Blog</title>


  <link rel="shortcut icon" href="https://hexo.io/icon/favicon-96x96.png">

  <!-- Custom CSS/Sass -->
  <link rel="stylesheet" href="/css/style.css">

  <!----------------------------
  https://github.com/GallenHu/hexo-theme-Daily

 _____            _   _
|  __ \          (_) | |
| |  | |   __ _   _  | |  _   _
| |  | |  / _` | | | | | | | | |
| |__| | | (_| | | | | | | |_| |
|_____/   \__,_| |_| |_|  \__, |
                          __/ |
                         |___/

    --------------------------->

</head>


<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="https://hexo.io/logo.svg" alt="Wade Zhao's Blog" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  home
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  archive
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            Using errors as control flow in Swift è¯‘æ–‡
            
          </h1>
          <p class="posted-on">
          2019-01-15
          </p>
          <div class="tags-links">
            
              
                <a href="/tags/è¯‘æ–‡ã€Swift/" rel="tag">
                  è¯‘æ–‡ã€Swift
                </a>
              
            
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content has_line_number">
          <h1 id="Using-errors-as-control-flow-in-Swift"><a href="#Using-errors-as-control-flow-in-Swift" class="headerlink" title="Using errors as control flow in Swift"></a>Using errors as control flow in Swift</h1><p>æˆ‘ä»¬å¦‚ä½•å¯¹APPå’Œç³»ç»Ÿä¸­çš„æ§åˆ¶æµè¿›è¡Œç®¡ç†ï¼Œä¼šåœ¨ä»£ç æ‰§è¡Œé€Ÿåº¦å’Œè°ƒè¯•éš¾æ˜“ç¨‹åº¦ä¸Šäº§ç”Ÿå…¨æ–¹é¢çš„å½±å“ã€‚æˆ‘ä»¬ä»£ç çš„æ§åˆ¶æµæœ¬è´¨ä¸Šæ˜¯æ‰§è¡Œå„ç§å‡½æ•°å’Œè¯­å¥çš„é¡ºåºï¼Œä»¥åŠæœ€ç»ˆè¾“å…¥çš„ä»£ç è·¯å¾„ã€‚</p>
<p>Swift æä¾›å¤šç§å¤šæ ·çš„å·¥å…·æ¥å®šä¹‰æ§åˆ¶æµ-ä¾‹å¦‚if, else and while, æˆ–è€…ç±»ä¼¼äºå¯é€‰å€¼çš„ç»“æ„ã€‚è¿™å‘¨ï¼Œå°±è®©æˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆæ„å»ºSiwftçš„é”™è¯¯æŠ›å‡ºå’Œæ„å»ºæ¨¡å‹æ¥ç¡®ä¿æˆ‘ä»¬çš„æ§åˆ¶æµèƒ½å¤Ÿæ›´å®¹æ˜“åœ°å»ç®¡ç†ã€‚</p>
<h2 id="æŠ›å¼ƒå¯é€‰ç±»å‹"><a href="#æŠ›å¼ƒå¯é€‰ç±»å‹" class="headerlink" title="æŠ›å¼ƒå¯é€‰ç±»å‹"></a>æŠ›å¼ƒå¯é€‰ç±»å‹</h2><p>å¯é€‰å€¼ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„è¯­è¨€ç‰¹æ€§å’Œä¸€ä¸ªå¾ˆæ£’çš„æ–¹å¼å»æ¨¡å‹åŒ–é‚£äº›èƒ½å¤Ÿè¢«åˆæ³•å¿½ç•¥çš„æ•°æ®ï¼Œåœ¨æ¶‰åŠç»™å®šå‡½æ•°å†…çš„æ§åˆ¶æµæ—¶ï¼Œä»–é€šå¸¸å¯ä»¥è¢«å½“åšä¸€ä¸ªæ¨¡æ¿å»ä½¿ç”¨ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä»APP Bundleä¸­åŠ è½½ä¸€å¼ å›¾ç‰‡çš„å‡½æ•°ï¼Œæ¥ä¸‹æ¥å¯¹è¿™å¼ å›¾ç‰‡tintå’Œé‡æ–°è°ƒæ•´å¤§å°ã€‚ç”±äºæ¯ä¸ªæ“ä½œéƒ½åœ¨å½“å‰ä¼šè¿”å›ä¸€ä¸ªå¯é€‰ç±»å‹çš„å›¾ç‰‡ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šæœ‰ä¿æŠ¤æˆ‘ä»¬å‡½æ•°é€€å‡ºçš„è¯­å¥ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">func loadImage(named name: String,</span><br><span class="line">               tintedWith color: UIColor,</span><br><span class="line">               resizedTo size: CGSize) -&gt; UIImage? &#123;</span><br><span class="line">    guard let baseImage = UIImage(named: name) else &#123;</span><br><span class="line">        return nil</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    guard let tintedImage = tint(baseImage, with: color) else &#123;</span><br><span class="line">        return nil</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return resize(tintedImage, to: size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿™æ ·å¤„ç†ä¼šé¢ä¸´çš„é—®é¢˜æ˜¯æˆ‘ä»¬åŸºæœ¬ä¸Šéƒ½ä¼šä½¿ç”¨nilå€¼æ¥å¤„ç†è¿è¡Œæ—¶çš„é”™è¯¯-è¿™æ ·æˆ‘ä»¬æ¯æ¬¡éƒ½è¦è¿›è¡Œè§£åŒ…ï¼Œå¹¶ä¸”ä¼šä»ç¬¬ä¸€å¤„éšè—é”™è¯¯å‘ç”Ÿçš„æ½œåœ¨åŸå› ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨æŠ›å‡ºå‡½æ•°å’Œé”™è¯¯æ¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªåœ¨å¤„ç†å›¾åƒä»£ç ä¸­å¯èƒ½å‡ºç°çš„æ¯ä¸ªé”™è¯¯çš„æšä¸¾ - çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enum ImageError: Error &#123;</span><br><span class="line">    case missing</span><br><span class="line">    case failedToCreateContext</span><br><span class="line">    case failedToRenderImage</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°†æ›´æ”¹æ‰€æœ‰å†…éƒ¨å‡½æ•°ï¼Œä»¥ä¾¿åœ¨å¤±è´¥æ—¶æŠ›å‡ºä¸Šè¿°é”™è¯¯ä¹‹ä¸€ï¼Œè€Œä¸æ˜¯è¿”å›nilã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•å¿«é€Ÿæ›´æ–°loadImageï¼ˆå‘½å:)ä»¥è¿”å›éå¯é€‰çš„UIImageæˆ–æŠ›å‡ºImageError.missingï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private func loadImage(named name: String) throws -&gt; UIImage &#123;</span><br><span class="line">    guard let image = UIImage(named: name) else &#123;</span><br><span class="line">        throw ImageError.missing</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return image</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€æ—¦æˆ‘ä»¬å¯¹å…¶ä»–å›¾åƒå¤„ç†å‡½æ•°åšç›¸åŒçš„å¤„ç†ï¼Œæˆ‘ä»¬ä¸€æ ·å¯ä»¥å°†ç›¸åŒçš„æ›´æ”¹åº”ç”¨åˆ°æˆ‘ä»¬çš„é¡¶çº§å‡½æ•° é‡ï¼Œåˆ é™¤æ‰€æœ‰å¯é€‰å€¼å¹¶ä½¿å…¶è¿”å›å…·ä½“å›¾åƒæˆ–æŠ›å‡ºåœ¨æˆ‘ä»¬çš„å‡½æ•°ä¸­äº§ç”Ÿçš„ä»»ä½•é”™è¯¯æ“ä½œï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func loadImage(named name: String,</span><br><span class="line">               tintedWith color: UIColor,</span><br><span class="line">               resizedTo size: CGSize) throws -&gt; UIImage &#123;</span><br><span class="line">    var image = try loadImage(named: name)</span><br><span class="line">    image = try tint(image, with: color)</span><br><span class="line">    return try resize(image, to: size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°æ›´æ”¹ä¸ä»…ä¼šä½¿æˆ‘ä»¬çš„å‡½æ•°ä½“æ›´ç®€å• - å®ƒè¿˜ä½¿å¾—è°ƒè¯•æ›´åŠ å®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨åœ¨å‡ºç°é—®é¢˜æ—¶æœ€åä¼šå‡ºç°å®šä¹‰å¥½çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯éœ€è¦å¼„æ¸…æ¥šå¯¼è‡´è¿”å›nilçš„åŸå› æ˜¯ä»€ä¹ˆã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…å¤„ç†ä¸­å¹¶ä¸æ˜¯å¯¹æ‰€æœ‰é”™è¯¯æ„Ÿå…´è¶£ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å¸Œæœ›åœ¨æˆ‘ä»¬çš„ä»£ç åº“ä¸­çš„ä»»ä½•åœ°æ–¹éƒ½è¦æ±‚ä½¿ç”¨doï¼Œtryï¼Œcatchæ¨¡å¼ï¼ˆå…·æœ‰è®½åˆºæ„å‘³çš„æ˜¯ï¼Œè¯•å›¾é¿å…äº§ç”Ÿå¤§å¤šæ•°ç›¸åŒçš„æ¨¡æ¿ï¼Œè€Œä¸æ˜¯ä¸€å‘³åœ°ç”¨è°ƒç”¨ä¸€å¥—æ¨¡æ¿ï¼‰ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶è¿”å›optional - å³ä½¿ä½¿ç”¨äº†throwæ¥å¤„ç†é”™è¯¯ã€‚éš¾é“æˆ‘ä»¬æ‰€è¦åšçš„å°±æ˜¯ä½¿ç”¨tryï¼Ÿ å½“è°ƒç”¨throwå‡½æ•°æ—¶çš„å…³é”®å­—ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è·å¾—ä¸€ä¸ªå¯é€‰å€¼çš„è¿”å›å€¼ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let optionalImage = try? loadImage(</span><br><span class="line">    named: &quot;Decoration&quot;,</span><br><span class="line">    tintedWith: .brandColor,</span><br><span class="line">    resizedTo: decorationSize</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>tryæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿå®ƒæ˜¯ä¸€ä¸ªä¸¤å…¨å…¶ç¾çš„è§£å†³æ–¹æ¡ˆã€‚æˆ‘ä»¬èƒ½å¤Ÿåœ¨è·å¾—ä¸€ä¸ªå¯é€‰å€¼çš„åŒæ—¶ä»è®©æˆ‘ä»¬åˆ©ç”¨throwå’Œerrorsçš„åŠ›é‡æ¥ç®¡ç†æˆ‘ä»¬çš„å†…éƒ¨æ§åˆ¶æµç¨‹</p>
<h2 id="éªŒè¯è¾“å…¥"><a href="#éªŒè¯è¾“å…¥" class="headerlink" title="éªŒè¯è¾“å…¥"></a>éªŒè¯è¾“å…¥</h2><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨è¾“å…¥éªŒè¯çš„åœºæ™¯ä¸‹å¦‚ä½•ä½¿ç”¨errorsæ”¹è¿›æ§åˆ¶æµã€‚å³ä½¿Swiftæœ‰ä¸€ä¸ªéå¸¸å…ˆè¿›å’Œå¼ºå¤§çš„ç±»å‹ç³»ç»Ÿï¼Œå®ƒä¹Ÿä¸èƒ½æ€»æ˜¯ç¡®ä¿æˆ‘ä»¬çš„å‡½æ•°å°†æ¥æ”¶æœ‰æ•ˆçš„è¾“å…¥ï¼Œæ‰€ä»¥è¿è¡Œæ—¶æ£€æŸ¥æœ‰æ—¶æ˜¯æˆ‘ä»¬å”¯ä¸€çš„é€‰æ‹©ã€‚</p>
<p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦ä¸€ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬åœ¨æ³¨å†Œæ–°å¸æˆ·æ—¶éœ€è¦å»éªŒè¯ç”¨æˆ·é€‰æ‹©çš„å‡­æ®ã€‚å°±åƒä»¥å‰ä¸€æ ·ï¼Œå½“å‰çš„ä»£ç å¯¹æ¯ä¸ªéªŒè¯è§„åˆ™éƒ½ä½¿ç”¨ä¿æŠ¤è¯­å¥ï¼Œå¹¶åœ¨å‘ç”Ÿæ•…éšœæ—¶è¾“å‡ºé”™è¯¯æ¶ˆæ¯ - å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">func signUpIfPossible(with credentials: Credentials) &#123;</span><br><span class="line">    guard credentials.username.count &gt;= 3 else &#123;</span><br><span class="line">        errorLabel.text = &quot;Username must contain min 3 characters&quot;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    guard credentials.password.count &gt;= 7 else &#123;</span><br><span class="line">        errorLabel.text = &quot;Password must contain min 7 characters&quot;</span><br><span class="line">        return</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Additional validation</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    service.signUp(with: credentials) &#123; result in</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å³ä½¿æˆ‘ä»¬åªéªŒè¯ä¸Šé¢çš„ä¸¤ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬éªŒè¯é€»è¾‘çš„ä»£ç æ•°é‡çš„å¢é•¿é€Ÿåº¦å°†ä¼šè¶…è¿‡æˆ‘ä»¬çš„é¢„æœŸã€‚å°†è¿™ç§é€»è¾‘ä¸æˆ‘ä»¬çš„UIä»£ç ï¼ˆé€šå¸¸åœ¨ViewControllerä¸­ï¼‰ä¸€èµ·ä½¿ç”¨ä¹Ÿä¼šä½¿æµ‹è¯•å˜å¾—æ›´åŠ å›°éš¾ã€‚æ‰€ä»¥è®©æˆ‘ä»¬çœ‹çœ‹æ˜¯å¦å¯ä»¥è¿›è¡Œä¸€äº›è§£è€¦å¹¶æ”¹å–„éªŒè¯é€»è¾‘çš„æ§åˆ¶æµç¨‹ã€‚</p>
<p>ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬èƒ½å¤Ÿè‡ªå·±åŒ…å«éªŒè¯ä»£ç ã€‚è¿™æ ·ï¼Œå®ƒæ—¢å¯ä»¥å•ç‹¬å¤„ç†ä¹Ÿå¯ä»¥å•ç‹¬æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥è½»æ¾é‡ç”¨åœ¨æˆ‘ä»¬çš„å…¶ä»–ä»£ç ä¸­ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬é¦–å…ˆä¸ºæ‰€æœ‰éªŒè¯é€»è¾‘åˆ›å»ºä¸€ä¸ªä¸“ç”¨ç±»å‹ã€‚ æˆ‘ä»¬å°†å…¶ç§°ä¸ºValidatorï¼Œå¹¶ä½¿å…¶æˆä¸ºä¸€ä¸ªç®€å•çš„ç»“æ„ï¼Œå®ƒåŒ…å«ç»™å®šValueç±»å‹çš„éªŒè¯é—­åŒ…ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">struct Validator&lt;Value&gt; &#123;</span><br><span class="line">    let closure: (Value) throws -&gt; Void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿæ„é€ éªŒè¯å™¨ï¼Œåªè¦å€¼æ²¡æœ‰é€šè¿‡éªŒè¯å°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ ä½†æ˜¯ï¼Œå¿…é¡»å§‹ç»ˆä¸ºæ¯ä¸ªéªŒè¯è¿‡ç¨‹å®šä¹‰ä¸€ä¸ªæ–°çš„é”™è¯¯ç±»å‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯èƒ½ä¼šå†æ¬¡ç”Ÿæˆä¸å¿…è¦çš„æ¨¡æ¿ï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦æŠŠé”™è¯¯æ˜¾ç¤ºç»™ç”¨æˆ·ï¼‰- è¿™æ ·æˆ‘ä»¬å¯ä»¥ç¼–å†™éªŒè¯çš„å‡½æ•°ï¼Œç®€å•åœ°ä¼ é€’ä¸€ä¸ªBoolå€¼å’Œä¸€æ¡æ¶ˆæ¯ï¼Œä»¥ä¾¿åœ¨å‘ç”Ÿæ•…éšœæ—¶æ˜¾ç¤ºç»™ç”¨æˆ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">struct ValidationError: LocalizedError &#123;</span><br><span class="line">    let message: String</span><br><span class="line">    var errorDescription: String? &#123; return message &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func validate(</span><br><span class="line">    _ condition: @autoclosure () -&gt; Bool,</span><br><span class="line">    errorMessage messageExpression: @autoclosure () -&gt; String</span><br><span class="line">) throws &#123;</span><br><span class="line">    guard condition() else &#123;</span><br><span class="line">        let message = messageExpression()</span><br><span class="line">        throw ValidationError(message: message)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æˆ‘ä»¬å†æ¬¡ä½¿ç”¨@autoclosureï¼Œå®ƒå…è®¸æˆ‘ä»¬é€šè¿‡è‡ªåŠ¨å°†è¡¨è¾¾å¼è§£åŒ…åœ¨é—­åŒ…ä¸­æ¥æ¨è¿Ÿè¡¨è¾¾å¼ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹<a href="https://www.swiftbysundell.com/posts/using-autoclosure-when-designing-swift-apis" target="_blank" rel="noopener">Using @autoclosure when designing Swift APIs</a></p>
<p>æœ‰äº†ä¸Šè¿°å†…å®¹ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°†æ‰€æœ‰éªŒè¯é€»è¾‘å®ç°ä¸ºä¸“ç”¨éªŒè¯å™¨ - ä½¿ç”¨Validatorç±»å‹ä¸Šçš„è®¡ç®—é™æ€å±æ€§æ„å»ºã€‚ ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•ä¸ºå¯†ç å®ç°éªŒè¯å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">extension Validator where Value == String &#123;</span><br><span class="line">    static var password: Validator &#123;</span><br><span class="line">        return Validator &#123; string in</span><br><span class="line">            try validate(</span><br><span class="line">                string.count &gt;= 7,</span><br><span class="line">                errorMessage: &quot;Password must contain min 7 characters&quot;</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            try validate(</span><br><span class="line">                string.lowercased() != string,</span><br><span class="line">                errorMessage: &quot;Password must contain an uppercased character&quot;</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            try validate(</span><br><span class="line">                string.uppercased() != string,</span><br><span class="line">                errorMessage: &quot;Password must contain a lowercased character&quot;</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬å†æ¬¡é‡è½½ä¸€ä¸ªValidateä½œä¸ºä¸€ä¸ªè¯­æ³•ç³–ï¼Œé€šè¿‡è°ƒç”¨è¦éªŒè¯çš„å€¼å’Œä½¿ç”¨çš„éªŒè¯å™¨ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func validate&lt;T&gt;(_ value: T,</span><br><span class="line">                 using validator: Validator&lt;T&gt;) throws &#123;</span><br><span class="line">    try validator.closure(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†æ‰€æœ‰æ„å»ºblockï¼Œè®©æˆ‘ä»¬æ›´æ–°è°ƒç”¨çš„åœ°æ–¹æ¥ä½¿ç”¨æˆ‘ä»¬çš„æ–°éªŒè¯ç³»ç»Ÿã€‚ä¸Šè¿°æ–¹æ³•çš„ä¼˜ç‚¹åœ¨äºï¼Œè™½ç„¶éœ€è¦ä¸€äº›é¢å¤–çš„ç±»å‹å’Œä¸€ç‚¹ç‚¹åŸºç¡€è®¾æ–½ï¼Œä½†å®ƒè®©æˆ‘ä»¬çš„ä»£ç åœ¨éœ€è¦è¾“å…¥éªŒè¯éå¸¸çš„cleanï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">func signUpIfPossible(with credentials: Credentials) throws &#123;</span><br><span class="line">    try validate(credentials.username, using: .username)</span><br><span class="line">    try validate(credentials.password, using: .password)</span><br><span class="line"></span><br><span class="line">    service.signUp(with: credentials) &#123; result in</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿè®¸æ›´å¥½çš„æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡ä½¿ç”¨doï¼Œtryï¼Œcatchçš„æ¨¡å¼å’Œè°ƒç”¨ä¸Šé¢çš„signUpIfPossibleå‡½æ•°æ¥å¤„ç†æ‰€æœ‰éªŒè¯é”™è¯¯ï¼Œç„¶åç®€å•åœ°å‘ç”¨æˆ·æ˜¾ç¤ºä»»ä½•æŠ›å‡ºé”™è¯¯çš„æœ¬åœ°åŒ–æè¿°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">do &#123;</span><br><span class="line">    try signUpIfPossible(with: credentials)</span><br><span class="line">&#125; catch &#123;</span><br><span class="line">    errorLabel.text = error.localizedDescription</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ä¸Šé¢çš„ä»£ç ç¤ºä¾‹æ²¡æœ‰ä½¿ç”¨ä»»ä½•æœ¬åœ°åŒ–ï¼Œä½†æˆ‘ä»¬æ€»æ˜¯å¸Œæœ›åœ¨çœŸå®åº”ç”¨ç¨‹åºä¸­å‘ç”¨æˆ·æ˜¾ç¤ºæ‰€æœ‰é”™è¯¯æ¶ˆæ¯æ—¶ä½¿ç”¨æœ¬åœ°åŒ–å­—ç¬¦ä¸²ã€‚</p>
<h2 id="æŠ›å‡ºæµ‹è¯•-Throwing-Tests"><a href="#æŠ›å‡ºæµ‹è¯•-Throwing-Tests" class="headerlink" title="æŠ›å‡ºæµ‹è¯•(Throwing Tests)"></a>æŠ›å‡ºæµ‹è¯•(Throwing Tests)</h2><p>å›´ç»•å¯èƒ½é‡åˆ°çš„é”™è¯¯æ¥æ„é€ ä»£ç çš„å¦ä¸€å¤§å¥½å¤„æ˜¯ï¼Œå®ƒé€šå¸¸ä½¿æµ‹è¯•æ›´å®¹æ˜“ã€‚ç”±äºæŠ›å‡ºå‡½æ•°æœ¬è´¨ä¸Šå…·æœ‰ä¸¤ä¸ªä¸åŒçš„å¯èƒ½è¾“å‡º-æ­£ç¡®çš„å€¼å’Œé”™è¯¯ - æ·»åŠ è¦†ç›–è¿™ä¸¤ç§æƒ…å½¢çš„æµ‹è¯•åœ¨å¾ˆå¤šæƒ…å†µä¸‹éå¸¸ç®€å•ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹æ˜¯æˆ‘ä»¬å¦‚ä½•è½»æ¾åœ°ä¸ºæˆ‘ä»¬çš„å¯†ç éªŒè¯ä»£ç æ·»åŠ æµ‹è¯• - é€šè¿‡ç®€å•åœ°æ–­è¨€åˆ°ä¸€ä¸ªé”™è¯¯æƒ…å†µæ¥è¿›è¡Œæ¶µç›–æˆ‘ä»¬çš„ä¸¤ä¸ªè¦æ±‚ï¼Œå¹¶ä¸”æˆåŠŸæ¡ˆä¾‹ä¸ä¼šï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class PasswordValidatorTests: XCTestCase &#123;</span><br><span class="line">    func testLengthRequirement() throws &#123;</span><br><span class="line">        XCTAssertThrowsError(try validate(&quot;aBc&quot;, using: .password))</span><br><span class="line">        try validate(&quot;aBcDeFg&quot;, using: .password)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    func testUppercasedCharacterRequirement() throws &#123;</span><br><span class="line">        XCTAssertThrowsError(try validate(&quot;abcdefg&quot;, using: .password))</span><br><span class="line">        try validate(&quot;Abcdefg&quot;, using: .password)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­£å¦‚æ‚¨åœ¨ä¸Šé¢æ‰€çœ‹åˆ°çš„ï¼Œå› ä¸ºXCTestæ”¯æŒthrowæµ‹è¯•å‡½æ•° - å¹¶ä¸”æ¯ä¸ªæœªå¤„ç†çš„é”™è¯¯éƒ½ç®—ä½œå¤±è´¥ - æ‰€æœ‰æˆ‘ä»¬è¦åšçš„å°±æ˜¯ä½¿ç”¨tryè°ƒç”¨æˆ‘ä»¬çš„validateå‡½æ•°æ¥éªŒè¯æˆåŠŸçš„æƒ…å†µï¼Œå¦‚æœå‡½æ•°æ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼Œé‚£æˆ‘ä»¬çš„æµ‹è¯•å°±æ˜¯æˆåŠŸğŸ‘ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥ç»„ç»‡Swiftä»£ç çš„æ§åˆ¶æµ - å¯¹äºå¯èƒ½æˆåŠŸæˆ–å¤±è´¥çš„æ“ä½œï¼Œä½¿ç”¨é”™è¯¯å’Œthrowå¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ è™½ç„¶è¿™æ ·åšéœ€è¦ä¸€äº›é¢å¤–çš„ä»£ç ï¼ˆä¾‹å¦‚å¼•å…¥é”™è¯¯ç±»å‹ï¼Œå¹¶ä¸”ç¡®ä¿æ‰€æœ‰çš„è°ƒç”¨éƒ½æ˜¯tryæˆ–è€…<code>try?</code>ï¼‰ - å®ƒå¯ä»¥ç»™æˆ‘ä»¬ä¸€äº›å®é™…çš„å¥½å¤„ï¼ŒåŒæ—¶ä¹Ÿä½¿æˆ‘ä»¬çš„ä»£ç æ›´ç´§å‡‘ã€‚</p>
<p>ä»ä¸€äº›å‡½æ•°ä¸­è¿”å›å¯é€‰å€¼ä¹Ÿæ˜¯åˆé€‚çš„ - ç‰¹åˆ«æ˜¯é‚£äº›æ²¡æœ‰ä»»ä½•æ˜æ˜¾é”™è¯¯çš„å‡½æ•° - ä½†æ˜¯åœ¨æˆ‘ä»¬å¤„ç†å‡ ä¸ªä¸åŒçš„å¯é€‰å€¼å’Œ<code>guard</code>è¯­å¥çš„åœ°æ–¹ - ä½¿ç”¨é”™è¯¯ä»£æ›¿å¯èƒ½ä¼šç»™æˆ‘ä»¬ä¸€ä¸ª æ›´åŠ æ¸…æ™°çš„æ§åˆ¶æµç¨‹ã€‚</p>
<p>ä½ æ€ä¹ˆçœ‹ï¼Ÿæ‚¨ç›®å‰æ˜¯å¦ä½¿ç”¨é”™è¯¯å’Œ<code>throw</code>æ¥ç®¡ç†ä»£ç çš„æ§åˆ¶æµç¨‹ - æˆ–è€…æ‚¨å°†å°è¯•ä½¿ç”¨å®ƒï¼Ÿ è¯·åœ¨Twitter @johnsundellä¸Šå‘Šè¯‰æˆ‘ - ä»¥åŠæ‚¨çš„é—®é¢˜ï¼Œæ„è§å’Œåé¦ˆã€‚</p>
<p>æ„Ÿè°¢é˜…è¯»ï¼<br>æ–‡ç« ä¸­æœ‰ç¿»è¯‘ä¸å‘¨çš„åœ°æ–¹ï¼Œå¯ä»¥è”ç³»æˆ‘å¾®åšï¼š<a href="https://weibo.com/u/5300292054?wvr=5&amp;is_all=1#_rnd1551097501695" target="_blank" rel="noopener">æˆ‘ä¼šæ¯å¤©æ—©ç¡çš„</a></p>

        </div>
      </article>
    </div>
    <!-- Comments -->
    <div class="container">
      
<section id="comment">
  <!-- <h1 class="title">Comments</h1> -->

  
  <div id="disqus_thread">
    <script type="text/javascript">
    var disqus_config = function () {
          this.page.url = window.location.href;
          this.page.identifier = 'using-è¯‘æ–‡';
          this.page.title = 'Using errors as control flow in Swift è¯‘æ–‡';
      };
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>


    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
      
        <div class="nav-next">
          <a href="/2018/11/08/å¹¶è¡Œè§£å†³è¯¡å¼‚é—®é¢˜/" rel="prev">Newer Posts <span class="meta-arraw meta-arraw-right"></span></a>
        </div>
      
    </div>

  </div>
</div>


  <!-- Footer -->
  <!-- Footer-widgets -->
<div class="footer-widgets">
  <div class="row inside-wrapper">
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">å…³äºæœ¬ç«™</h1>
        <div class="custom-widget-content">
          
          <p>These violent delights have violent ends ,and in their triumph die ,like fire and powder ,which,as they kiss ,consume</p>
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">Contact</h1>
        <div class="widget-text">
          
            
              <a href="https://github.com/WadeZhao23" class="icon icon-github" target="_blank">github</a>
            
              <a href="https://weibo.com/5300292054/profile?rightmod=1&wvr=6&mod=personinfo" class="icon icon-weibo" target="_blank">weibo</a>
            
              <a href="zhaoyuwei23@gmail.com" class="icon icon-mail" target="_blank">mail</a>
            
              <a href="https://twitter.com/Tweg24" class="icon icon-twitter" target="_blank">twitter</a>
            
          
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">Search</h1>
        <div class="widget-text">
          <form onSubmit="return appDaily.submitSearch('')">
            <p>
              <input type="text" placeholder="search..." id="homeSearchInput">
            </p>
            <!-- <input type="submit" value="GO"> -->
          </form>
        </div>
      </aside>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="site-info">
  <p>
    <span>Wade Zhao's Blog &copy; 2019</span>
    
      <span class="split">|</span>
      <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> with Theme <a href="https://github.com/GallenHu/hexo-theme-Daily" target="_blank">Daily</a></span>
    
  </p>
</footer>


  <!-- After footer scripts -->
  <!-- scripts -->
<script src="/js/app.js"></script>

<script>
  var disqus_shortname = 'WadeZhao';

  
  var disqus_url = 'http://yoursite.com/2019/01/15/è¯‘æ–‡/';
  

  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>





</body>

</html>
